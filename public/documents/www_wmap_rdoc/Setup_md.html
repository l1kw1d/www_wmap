<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>Setup - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Setup+Hosting+Environment">Setup Hosting Environment</a>
    <li><a href="#label-1.+Service+Account+Setup">1. Service Account Setup</a>
    <li><a href="#label-2.+Install+RVM+environment-3A">2. Install RVM environment:</a>
    <li><a href="#label-3.+Install+Ruby+and+Ruby+on+Rails-3A">3. Install Ruby and Ruby on Rails:</a>
    <li><a href="#label-4.+Install+the+wmap+Gem-3A">4. Install the wmap Gem:</a>
    <li><a href="#label-5.+Install+the+MariaDB+database+instance-3A">5. Install the MariaDB database instance:</a>
    <li><a href="#label-5.1+Install+DB">5.1 Install DB</a>
    <li><a href="#label-5.2+Start+Maria+DB-3A">5.2 Start Maria DB:</a>
    <li><a href="#label-6.+Install+and+Run+Redis+server-3A">6. Install and Run Redis server:</a>
    <li><a href="#label-6.1.+Install+Redis+server">6.1. Install Redis server</a>
    <li><a href="#label-6.2.+Configure+redis+server-3A">6.2. Configure redis server:</a>
    <li><a href="#label-6.3.+Running+the+redis+server-3A">6.3. Running the redis server:</a>
    <li><a href="#label-6.4.+Check+the+redis+service-3A">6.4. Check the redis service:</a>
    <li><a href="#label-7.+Install+Sidekiq-3A">7. Install Sidekiq:</a>
    <li><a href="#label-7.1.+Configure+Sidekiq+as+service-3A">7.1. Configure Sidekiq as service:</a>
    <li><a href="#label-7.2.+Enable+Sidekiq+service-3A">7.2. Enable Sidekiq service:</a>
    <li><a href="#label-7.3.+Trouble-shooting+Sidekiq-3A">7.3. Trouble-shooting Sidekiq:</a>
    <li><a href="#label-8.+Install+JS+runtime-3A">8. Install JS runtime:</a>
    <li><a href="#label-9.+Install+wmap+front-end-3A">9. Install wmap front-end:</a>
    <li><a href="#label-9.1.+Update+the+rails+environment-3A">9.1. Update the rails environment:</a>
    <li><a href="#label-9.2.+Create+the+database+instance-3A">9.2. Create the database instance:</a>
    <li><a href="#label-9.3.+Create+the+database+table-3A">9.3. Create the database table:</a>
    <li><a href="#label-9.4.+Generate+the+application+encryption+key-3A">9.4. Generate the application encryption key:</a>
    <li><a href="#label-9.5.+Configure+the+rails+environment+variables-3A">9.5. Configure the rails environment variables:</a>
    <li><a href="#label-Add+MariaDB+Connectivity+credential">Add MariaDB Connectivity credential</a>
    <li><a href="#label-Add+Redis+connection+url">Add Redis connection url</a>
    <li><a href="#label-10.+Puma+Application+Server">10. Puma Application Server</a>
    <li><a href="#label-10.1+Puma+Configuration">10.1 Puma Configuration</a>
    <li><a href="#label-11.+Install+NGINX-3A">11. Install NGINX:</a>
    <li><a href="#label-11.1.+Create+a+certificate.+Use+Let-27s+Encrypt+Certificate+Authority+to+secure+the+site.">11.1. Create a certificate. <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-18-04">Use Let’s Encrypt Certificate Authority</a> to secure the site.</a>
    <li><a href="#label-11.2.+Configure+the+web+server-3A">11.2. Configure the web server:</a>
    <li><a href="#label-11.3.+Run+Nginx+as+Service">11.3. Run Nginx as Service</a>
    <li><a href="#label-12.+Setup+Ubuntu+Firewall-3A">12. Setup Ubuntu Firewall:</a>
    <li><a href="#label-13.+Setup+Postfix+as+Send+Only+SMTP+Server">13. Setup Postfix as Send Only SMTP Server</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./Dockerfile.html">Dockerfile</a>
  
    <li><a href="./Gemfile.html">Gemfile</a>
  
    <li><a href="./Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="./Rakefile.html">Rakefile</a>
  
    <li><a href="./Readme_md.html">Readme</a>
  
    <li><a href="./Setup_md.html">Setup</a>
  
    <li><a href="./app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="./app/assets/javascripts/bootstrap_min_js.html">bootstrap.min.js</a>
  
    <li><a href="./app/assets/javascripts/cidrs_coffee.html">cidrs.coffee</a>
  
    <li><a href="./app/assets/javascripts/codemirror_js.html">codemirror.js</a>
  
    <li><a href="./app/assets/javascripts/domain_map_js.html">domain_map.js</a>
  
    <li><a href="./app/assets/javascripts/domains_coffee.html">domains.coffee</a>
  
    <li><a href="./app/assets/javascripts/hosts_coffee.html">hosts.coffee</a>
  
    <li><a href="./app/assets/javascripts/jstree_js.html">jstree.js</a>
  
    <li><a href="./app/assets/javascripts/jstree_min_js.html">jstree.min.js</a>
  
    <li><a href="./app/assets/javascripts/logs_coffee.html">logs.coffee</a>
  
    <li><a href="./app/assets/javascripts/popper_js.html">popper.js</a>
  
    <li><a href="./app/assets/javascripts/popup_js.html">popup.js</a>
  
    <li><a href="./app/assets/javascripts/rails_validations_js.html">rails.validations.js</a>
  
    <li><a href="./app/assets/javascripts/reports_coffee.html">reports.coffee</a>
  
    <li><a href="./app/assets/javascripts/sites_coffee.html">sites.coffee</a>
  
    <li><a href="./app/assets/javascripts/tags_coffee.html">tags.coffee</a>
  
    <li><a href="./app/assets/javascripts/yaml_js.html">yaml.js</a>
  
    <li><a href="./app/assets/javascripts/yml_settings_js.html">yml_settings.js</a>
  
    <li><a href="./app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="./app/assets/stylesheets/bootstrap_min_css.html">bootstrap.min.css</a>
  
    <li><a href="./app/assets/stylesheets/bootstrap_and_overrides_css.html">bootstrap_and_overrides.css</a>
  
    <li><a href="./app/assets/stylesheets/cidrs_scss.html">cidrs.scss</a>
  
    <li><a href="./app/assets/stylesheets/codemirror_css.html">codemirror.css</a>
  
    <li><a href="./app/assets/stylesheets/domains_scss.html">domains.scss</a>
  
    <li><a href="./app/assets/stylesheets/hosts_scss.html">hosts.scss</a>
  
    <li><a href="./app/assets/stylesheets/jstree_css.html">jstree.css</a>
  
    <li><a href="./app/assets/stylesheets/jstree_min_css.html">jstree.min.css</a>
  
    <li><a href="./app/assets/stylesheets/logs_scss.html">logs.scss</a>
  
    <li><a href="./app/assets/stylesheets/popup_css.html">popup.css</a>
  
    <li><a href="./app/assets/stylesheets/reports_scss.html">reports.scss</a>
  
    <li><a href="./app/assets/stylesheets/scaffolds_scss.html">scaffolds.scss</a>
  
    <li><a href="./app/assets/stylesheets/sites_scss.html">sites.scss</a>
  
    <li><a href="./app/assets/stylesheets/tags_scss.html">tags.scss</a>
  
    <li><a href="./app/assets/stylesheets/yml_settings_scss.html">yml_settings.scss</a>
  
    <li><a href="./app/views/reports/_report_json_jbuilder.html">_report.json.jbuilder</a>
  
    <li><a href="./app/views/reports/index_json_jbuilder.html">index.json.jbuilder</a>
  
    <li><a href="./app/views/reports/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="./app/views/sites/show_html_erb_old.html">show.html.erb.old</a>
  
    <li><a href="./bin/deploy_wmap_sh.html">deploy_wmap.sh</a>
  
    <li><a href="./config_ru.html">config.ru</a>
  
    <li><a href="./config/credentials_yml_enc.html">credentials.yml.enc</a>
  
    <li><a href="./config/docker/asset-pre-compile_sh.html">asset-pre-compile.sh</a>
  
    <li><a href="./config/docker/entrypoint_sh.html">entrypoint.sh</a>
  
    <li><a href="./config/docker/prepare-db_sh.html">prepare-db.sh</a>
  
    <li><a href="./config/docker/start_sh.html">start.sh</a>
  
    <li><a href="./config/master_key.html">master.key</a>
  
    <li><a href="./config/nginx_conf.html">nginx.conf</a>
  
    <li><a href="./config/redis_conf.html">redis.conf</a>
  
    <li><a href="./config/systemd/main_cf.html">main.cf</a>
  
    <li><a href="./config/systemd/nginx_service.html">nginx.service</a>
  
    <li><a href="./config/systemd/redis_service.html">redis.service</a>
  
    <li><a href="./config/systemd/sidekiq_service.html">sidekiq.service</a>
  
    <li><a href="./lib/tasks/rdoc_rake.html">rdoc.rake</a>
  
    <li><a href="./lib/tasks/sync_rake.html">sync.rake</a>
  
    <li><a href="./lib/tasks/wmap_rake.html">wmap.rake</a>
  
    <li><a href="./log/development_log.html">development.log</a>
  
    <li><a href="./log/puma_stderr_log.html">puma.stderr.log</a>
  
    <li><a href="./log/puma_stdout_log.html">puma.stdout.log</a>
  
    <li><a href="./log/sidekiq_log.html">sidekiq.log</a>
  
    <li><a href="./package-lock_json.html">package-lock.json</a>
  
    <li><a href="./public/404_html.html">404.html</a>
  
    <li><a href="./public/422_html.html">422.html</a>
  
    <li><a href="./public/500_html.html">500.html</a>
  
    <li><a href="./public/assets/application-063a6bd4ee6aa5f787fd83f38089b08e2b9a7262c6e4f749c4c21c22ba99c83f_css.html">application-063a6bd4ee6aa5f787fd83f38089b08e2b9a7262c6e4f749c4c21c22ba99c83f.css</a>
  
    <li><a href="./public/assets/application-de86c8163994c5a9d66f66d7b3c93aa3decbabea330334d4fdf164e1a3b6d616_js.html">application-de86c8163994c5a9d66f66d7b3c93aa3decbabea330334d4fdf164e1a3b6d616.js</a>
  
    <li><a href="./public/assets/application-fbc0ca1b5b1b4d1dd3d8f9626710f527f7e154f13661ef9f721262b0421ab9f9_css.html">application-fbc0ca1b5b1b4d1dd3d8f9626710f527f7e154f13661ef9f721262b0421ab9f9.css</a>
  
    <li><a href="./public/assets/codemirror-4fc3fe9f207458690501ffca79f799333752dff031ce9d2bfffbe67ad65eb23a_css.html">codemirror-4fc3fe9f207458690501ffca79f799333752dff031ce9d2bfffbe67ad65eb23a.css</a>
  
    <li><a href="./public/assets/glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5_svg.html">glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5.svg</a>
  
    <li><a href="./public/assets/hosts-877aef30ae1b040ab8a3aba4e3e309a11d7f2612f44dde450b5c157aa5f95c05_js.html">hosts-877aef30ae1b040ab8a3aba4e3e309a11d7f2612f44dde450b5c157aa5f95c05.js</a>
  
    <li><a href="./public/assets/jstree_min-487bd81b69d667265667f45bdab0ff83f0a108b3570da4380eda70486b9e2db3_css.html">jstree.min-487bd81b69d667265667f45bdab0ff83f0a108b3570da4380eda70486b9e2db3.css</a>
  
    <li><a href="./public/assets/jstree_min-9904f000b38ec8e834e2e237b535e042e14eb62f3eeeebdc1dcd008f17f05e94_css.html">jstree.min-9904f000b38ec8e834e2e237b535e042e14eb62f3eeeebdc1dcd008f17f05e94.css</a>
  
    <li><a href="./public/assets/jstree_min-e38f0421e4cc9b47a3cd68c8a2552e1a898942b5bd5ea57910e194932a378760_js.html">jstree.min-e38f0421e4cc9b47a3cd68c8a2552e1a898942b5bd5ea57910e194932a378760.js</a>
  
    <li><a href="./public/assets/popup-2b9450ea834a6181296800bf1b75997c73b4eac5495fbdc5239fc0512d31c182_js.html">popup-2b9450ea834a6181296800bf1b75997c73b4eac5495fbdc5239fc0512d31c182.js</a>
  
    <li><a href="./public/assets/yaml-813a4722938752a1eb3c02f6cf883b30094d6f12e141c51bda411c5164c3d4aa_js.html">yaml-813a4722938752a1eb3c02f6cf883b30094d6f12e141c51bda411c5164c3d4aa.js</a>
  
    <li><a href="./public/assets/yml_settings-52928a9d045e6bbfae71495c925605341684f629d8764dbae387e91e00110fa7_js.html">yml_settings-52928a9d045e6bbfae71495c925605341684f629d8764dbae387e91e00110fa7.js</a>
  
    <li><a href="./public/robots_txt.html">robots</a>
  
    <li><a href="./shared/data/cidrs.html">cidrs</a>
  
    <li><a href="./shared/data/deactivated_sites.html">deactivated_sites</a>
  
    <li><a href="./shared/data/domains.html">domains</a>
  
    <li><a href="./shared/data/hosts.html">hosts</a>
  
    <li><a href="./shared/data/logs/discovered_sites_log.html">discovered_sites.log</a>
  
    <li><a href="./shared/data/logs/discovered_urls_log.html">discovered_urls.log</a>
  
    <li><a href="./shared/data/logs/url_seeds_log.html">url_seeds.log</a>
  
    <li><a href="./shared/data/logs/wmap_log.html">wmap.log</a>
  
    <li><a href="./shared/data/seed.html">seed</a>
  
    <li><a href="./shared/data/sites.html">sites</a>
  
    <li><a href="./shared/log/development_log.html">development.log</a>
  
    <li><a href="./shared/log/puma_stderr_log.html">puma.stderr.log</a>
  
    <li><a href="./shared/log/puma_stdout_log.html">puma.stdout.log</a>
  
    <li><a href="./shared/log/sidekiq_log.html">sidekiq.log</a>
  
    <li><a href="./shared/tmp/puma_state.html">puma.state</a>
  
    <li><a href="./tmp/pids/sidekiq_pid.html">sidekiq.pid</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page Setup.md">

<h1 id="label-Setup+Hosting+Environment"><a href="Setup_md.html">Setup</a> Hosting Environment<span><a href="#label-Setup+Hosting+Environment">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><a href="Setup_md.html">Setup</a> the runtime environment in Ubuntu 18.0.4
Linux distrobution</p>

<h2 id="label-1.+Service+Account+Setup">1. Service Account <a href="Setup_md.html">Setup</a><span><a href="#label-1.+Service+Account+Setup">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>To start, we&#39;ll create a service account “deploy” for the Rails app
running environment. We&#39;ll add the service account to the special group
&#39;wheel&#39;, which is allowed to have &#39;sudo&#39; access. <code>sh #
adduser deploy # addgroup wheel # usermod -aG wheel deploy </code></p>

<h2 id="label-2.+Install+RVM+environment-3A">2. Install RVM environment:<span><a href="#label-2.+Install+RVM+environment-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Refer to <a href="https://rvm.io">rvm.io</a>/</p>

<h2 id="label-3.+Install+Ruby+and+Ruby+on+Rails-3A">3. Install Ruby and Ruby on Rails:<span><a href="#label-3.+Install+Ruby+and+Ruby+on+Rails-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre>$ rvm list
=* ruby-2.6.3 [ x86_64 ]
$ ruby -v
ruby 2.6.3p62 (2019-04-16 revision 67580) [x86_64-linux]</pre>

<h2 id="label-4.+Install+the+wmap+Gem-3A">4. Install the wmap Gem:<span><a href="#label-4.+Install+the+wmap+Gem-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Refer to: <a
href="https://github.com/yangsec888/wmap/blob/master/README.rdoc">github.com/yangsec888/wmap/blob/master/README.rdoc</a></p>

<h2 id="label-5.+Install+the+MariaDB+database+instance-3A">5. Install the MariaDB database instance:<span><a href="#label-5.+Install+the+MariaDB+database+instance-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="label-5.1+Install+DB">5.1 Install DB<span><a href="#label-5.1+Install+DB">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Refer to <a
href="https://computingforgeeks.com/install-mariadb-10-on-ubuntu-18-04-and-centos-7">computingforgeeks.com/install-mariadb-10-on-ubuntu-18-04-and-centos-7</a>/
<code>sh $ sudo apt -y install mariadb-server mariadb-client </code></p>

<h3 id="label-5.2+Start+Maria+DB-3A">5.2 Start Maria DB:<span><a href="#label-5.2+Start+Maria+DB-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ sudo systemctl start mysql</pre>

<h2 id="label-6.+Install+and+Run+Redis+server-3A">6. Install and Run Redis server:<span><a href="#label-6.+Install+and+Run+Redis+server-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The app use Redis to handle the async job queue. Refer to <a
href="https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04">this
article</a> for detail installation instructions.</p>

<h3 id="label-6.1.+Install+Redis+server">6.1. Install Redis server<span><a href="#label-6.1.+Install+Redis+server">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ sudo apt install redis-server</pre>

<h3 id="label-6.2.+Configure+redis+server-3A">6.2. Configure redis server:<span><a href="#label-6.2.+Configure+redis+server-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ sudo vi /etc/redis/redis.conf</pre>

<h3 id="label-6.3.+Running+the+redis+server-3A">6.3. Running the redis server:<span><a href="#label-6.3.+Running+the+redis+server-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ sudo systemctl restart redis.service</pre>

<p>You can also use our deployment <a
href="/config/systemd/redis.service">redis.service</a> under Ubuntu 18.0.4
instance for further reference.</p>

<h3 id="label-6.4.+Check+the+redis+service-3A">6.4. Check the redis service:<span><a href="#label-6.4.+Check+the+redis+service-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ sudo systemctl status redis
$ redis-cli ping</pre>

<p>Expecting ‘PONG’ response for success.</p>

<h2 id="label-7.+Install+Sidekiq-3A">7. Install Sidekiq:<span><a href="#label-7.+Install+Sidekiq-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Download sidekiq gem: <code>sh $ gem install sidekiq </code></p>

<h3 id="label-7.1.+Configure+Sidekiq+as+service-3A">7.1. Configure <a href="Sidekiq.html">Sidekiq</a> as service:<span><a href="#label-7.1.+Configure+Sidekiq+as+service-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>This <a
href="https://gist.github.com/reabiliti/7204115b433e7bd986343d7709f05c2a">post</a>
provides detail configuration instructions for running your sidekiq as a
service.<br> <code>sh $ sudo vi /lib/systemd/system/sidekiq.service </code>
You can also use our deployment <a
href="/config/systemd/sidekiq.service">sidekiq.service</a> under Ubuntu
18.0.4 instance for further reference.</p>

<h3 id="label-7.2.+Enable+Sidekiq+service-3A">7.2. Enable <a href="Sidekiq.html">Sidekiq</a> service:<span><a href="#label-7.2.+Enable+Sidekiq+service-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ sudo systemctl daemon-reload
$ sudo systemctl start sidekiq</pre>

<h3 id="label-7.3.+Trouble-shooting+Sidekiq-3A">7.3. Trouble-shooting Sidekiq:<span><a href="#label-7.3.+Trouble-shooting+Sidekiq-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ ps uax | grep sidekiq
$ sudo systemctl status sidekiq</pre>

<h2 id="label-8.+Install+JS+runtime-3A">8. Install JS runtime:<span><a href="#label-8.+Install+JS+runtime-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre>$ sudo apt install nodejs</pre>

<h2 id="label-9.+Install+wmap+front-end-3A">9. Install wmap front-end:<span><a href="#label-9.+Install+wmap+front-end-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre>$ git clone https://github.com/yangsec888/www_wmap.git</pre>

<h3 id="label-9.1.+Update+the+rails+environment-3A">9.1. Update the rails environment:<span><a href="#label-9.1.+Update+the+rails+environment-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ bundle install</pre>

<h3 id="label-9.2.+Create+the+database+instance-3A">9.2. Create the database instance:<span><a href="#label-9.2.+Create+the+database+instance-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ rake db:create</pre>

<h3 id="label-9.3.+Create+the+database+table-3A">9.3. Create the database table:<span><a href="#label-9.3.+Create+the+database+table-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>$ rake db:migrate</pre>

<h3 id="label-9.4.+Generate+the+application+encryption+key-3A">9.4. Generate the application encryption key:<span><a href="#label-9.4.+Generate+the+application+encryption+key-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Refer to <a
href="https://github.com/rails/rails/blob/master/railties/lib/rails/commands/credentials/USAGE">this
article</a> for details: <code>sh $ rails credentials:help </code></p>

<h3 id="label-9.5.+Configure+the+rails+environment+variables-3A">9.5. Configure the rails environment variables:<span><a href="#label-9.5.+Configure+the+rails+environment+variables-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Here are the environmental variables you might need to add to environment:
“`sh $ vi ~/.bashrc … export PATH=“$PATH:$HOME/.rvm/bin” export
RAILS_ENV=production export SECRET_KEY_BASE=xxxx export
RAILS_MASTER_KEY=xxxx</p>

<h1 id="label-Add+MariaDB+Connectivity+credential">Add MariaDB Connectivity credential<span><a href="#label-Add+MariaDB+Connectivity+credential">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>export DBUSER=xxxx export DBPASS=xxxx export
DATABASE_URL=mysql2://root:@localhost:3306/www_wmap_development</p>

<h1 id="label-Add+Redis+connection+url">Add Redis connection url<span><a href="#label-Add+Redis+connection+url">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>export REDIS_URL=redis://localhost:6379/0 “`</p>

<h2 id="label-10.+Puma+Application+Server">10. Puma Application Server<span><a href="#label-10.+Puma+Application+Server">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Puma is the build-in application server for Rails 5. You might want to
configure it in &#39;config/puma.rb&#39; Refer to <a
href="https://www.digitalocean.com/community/tutorials/how-to-deploy-a-rails-app-with-puma-and-nginx-on-ubuntu-14-04">How
to Deploy a Rails App with Puma and Nginx</a> for detail explanations.</p>

<h3 id="label-10.1+Puma+Configuration">10.1 Puma Configuration<span><a href="#label-10.1+Puma+Configuration">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Refer to <a href="/config/puma.rb">puma.rb</a> for detail.</p>

<h2 id="label-11.+Install+NGINX-3A">11. Install NGINX:<span><a href="#label-11.+Install+NGINX-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>We&#39;ll use Nginx web server for the web server layer. It&#39;s perfect
server to render static application asset. In addition, it&#39;ll be setup
to proxy traffic for Rails service running in the Puma application server
layer.</p>

<pre>$ sudo apt-get install nginx</pre>

<h3 id="label-11.1.+Create+a+certificate.+Use+Let-27s+Encrypt+Certificate+Authority+to+secure+the+site.">11.1. Create a certificate. <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-18-04">Use Let’s Encrypt Certificate Authority</a> to secure the site.<span><a href="#label-11.1.+Create+a+certificate.+Use+Let-27s+Encrypt+Certificate+Authority+to+secure+the+site.">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre>deploy@www:~$ sudo add-apt-repository ppa:certbot/certbot
deploy@www:~$ sudo apt install python-certbot-nginx
deploy@www:~$ sudo certbot --nginx -d wmap.io -d www.wmap.io
deploy@www:~$ sudo certbot renew --dry-run
deploy@www:~$ sudo vi /etc/nginx/sites-available/www_wmap</pre>

<h3 id="label-11.2.+Configure+the+web+server-3A">11.2. Configure the web server:<span><a href="#label-11.2.+Configure+the+web+server-3A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Make sure it&#39;s tight up with your Puma application configuration. Refer
to <a href="/config/nginx.conf">nginx.conf</a> for more details.</p>

<h3 id="label-11.3.+Run+Nginx+as+Service">11.3. Run Nginx as Service<span><a href="#label-11.3.+Run+Nginx+as+Service">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You can also use our deployment <a
href="/config/systemd/nginx.service">nginx.service</a> under Ubuntu 18.0.4
instance for further reference.</p>

<h2 id="label-12.+Setup+Ubuntu+Firewall-3A">12. <a href="Setup_md.html">Setup</a> Ubuntu Firewall:<span><a href="#label-12.+Setup+Ubuntu+Firewall-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>How to <a
href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04">Setup
a Firewall with UFW</a> on Ubuntu:</p>

<h2 id="label-13.+Setup+Postfix+as+Send+Only+SMTP+Server">13. <a href="Setup_md.html">Setup</a> Postfix as Send Only SMTP Server<span><a href="#label-13.+Setup+Postfix+as+Send+Only+SMTP+Server">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The App would need to send out notification email of async jobs. Such as
upon successful asset discovery job. In order to do that, you would need to
setup a SMTP send out only server. Refer to <a
href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-postfix-as-a-send-only-smtp-server-on-debian-10">this
article</a> for detail explanations and instructions.</p>

<p>After configuring the postfix main.cf file, don&#39;t forget to refresh the
postfix system: <code>sh $ sudo postfix reload </code></p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.3.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

